# any commit to the master branch will trigger the CI build
trigger:
  - master

# use a Windows agent with VS to build the .NET Core MSTest project
# you can replace this with Ubuntu too without changing the tasks
pool:
  name: Azure Pipelines
  vmImage: windows-latest

variables:
  DOTNET_SKIP_FIRST_TIME_EXPERIENCE: true

stages:
  - stage: CI
    jobs:
      - job: Build
        steps:
          - task: NuGetToolInstaller@1
            inputs:
              checkLatest: false

          - task: NuGetCommand@2
            displayName: NuGet v2 Restore

          - task: DotNetCoreCLI@2
            displayName: Restore
            inputs:
              command: restore
              projects: '**/SeleniumTest.csproj'

          - task: DotNetCoreCLI@2
            displayName: Publish
            inputs:
              command: publish
              publishWebProjects: false
              projects: '**/SeleniumTest.csproj'
              arguments: '--configuration Release -o $(build.artifactstagingdirectory)/SeleniumTest'
              zipAfterPublish: false
              modifyOutputPath: false

          - task: PublishBuildArtifacts@1
            displayName: 'Publish Artifact'
            inputs:
              PathtoPublish: '$(build.artifactstagingdirectory)'
            condition: succeededOrFailed()

  - stage: qac
    jobs:
      - job: RunTests
        steps:
          - task: VSTest@2
            displayName: 'Run Visual Studio Tests'
            inputs:
              testSelector: 'testAssemblies'
              testAssemblyVer2: |
                **\*test*.dll
                !**\*TestAdapter.dll
                !**\obj\**
              searchFolder: '$(System.DefaultWorkingDirectory)/SeleniumTest'
              codeCoverageEnabled: true
              runInParallel: true
